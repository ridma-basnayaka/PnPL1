function [R,t,s] = recover(r,W,V)
%using t calculated before to recover 
%rotation R and translation t

%recover R_bar
R = reshape(r,3,3)';
[Ur,~,Vr] = svd(R);
R_e = Ur*Vr';
% trail2 ----- 22

%recover s
syms s1 s2 s3 real;
ss = [s1;s2;s3];
s_x = [ 0 -s3 s2;
       s3  0 -s1;
       -s2 s1  0];

f1 = (R_e - R_e') - 4.*s_x/(1+ss'*ss);
f2 = trace(R_e) - (3-ss'*ss)/(1+ss'*ss);
ssol = vpasolve(f1,[s1;s2;s3]);
if size(ssol.s1,1) == 1
    s = [ssol.s1;ssol.s2;ssol.s3];
else
    for i = 1:size(ssol.s1,1)
        sol = [ssol.s1(i);ssol.s2(i);ssol.s3(i)];
        f2val = subs(f2,ss,sol);
        if(abs(f2val) < 0.00001)
            s = sol;
            break;
        else
            s = [];
        end
    end
end

%recover t
if isempty(s)
    R = -1;
    t = -1;
    return;
else
    [R,t,~,~] = s2Rt(s,W,V);
end
    
end
% 
% W = [1, 0, -0.019193999;
% 0, 1, -0.19167098;
% 1, 0, -0.22371601;
% 0, 1, -0.075855985;
% 1, 0, -0.23588397;
% 0, 1, -0.17282198;
% 1, 0, 0.024328003;
% 0, 1, -0.15363102;
% 1, 0, 0.05539801;
% 0, 1, -0.283602;
% 1, 0, -0.146487;
% 0, 1, -0.26553899;
% 1, 0, -0.027121002;
% 0, 1, -0.26189002;
% 1, 0, 0.061601989;
% 0, 1, -0.047023986;
% 1, 0, -0.14411402;
% 0, 1, -0.12263101;
% 1, 0, 0.121851;
% 0, 1, -0.15034601;
% 1, 0, -0.22713098;
% 0, 1, -0.335067;
% 1, 0, -0.081802003;
% 0, 1, -0.15782999;
% 1, 0, -0.18793301;
% 0, 1, -0.30220598;
% 1, 0, -0.18378;
% 0, 1, -0.26243302;
% 1, 0, 0.028425995;
% 0, 1, -0.17714199;
% 1, 0, -0.003472992;
% 0, 1, -0.221466;
% 1, 0, -0.18679;
% 0, 1, -0.07893201;
% 1, 0, -0.14508301;
% 0, 1, -0.29457599;
% 1, 0, -0.18118201;
% 0, 1, -0.099571012;
% 1, 0, -0.01040799;
% 0, 1, -0.025705993]
% V = [0.068309002, -0.37358299, -0.93080097, 0, 0, 0, -0.0013111229, 0.0071705519, 0.017865794;
% 0, 0, 0, 0.068309002, -0.37358299, -0.93080097, -0.013092853, 0.071605019, 0.17840753;
% -0.21480601, -0.16604, -0.99716699, 0, 0, 0, 0.048055541, 0.037145805, 0.22308221;
% 0, 0, 0, -0.21480601, -0.16604, -0.99716699, 0.016294321, 0.012595128, 0.075641088;
% -0.25369599, -0.30049899, -0.94743001, 0, 0, 0, 0.059842817, 0.070882894, 0.22348355;
% 0, 0, 0, -0.25369599, -0.30049899, -0.94743001, 0.043844245, 0.05193283, 0.16373673;
% 0.141862, -0.32913899, -0.949081, 0, 0, 0, 0.0034512193, -0.0080072945, -0.023089245;
% 0, 0, 0, 0.141862, -0.32913899, -0.949081, -0.021794405, 0.050565958, 0.14580828;
% 0.161016, -0.51951897, -0.88090998, 0, 0, 0, 0.0089199664, -0.028780317, -0.048800658;
% 0, 0, 0, 0.161016, -0.51951897, -0.88090998, -0.045664459, 0.14733662, 0.24982783;
% -0.138882, -0.450719, -0.89666301, 0, 0, 0, 0.020344406, 0.066024475, 0.13134947;
% 0, 0, 0, -0.138882, -0.450719, -0.89666301, 0.036878586, 0.11968347, 0.23809899;
% 0.041476801, -0.47114199, -0.89475602, 0, 0, 0, -0.0011248924, 0.012777843, 0.024266679;
% 0, 0, 0, 0.041476801, -0.47114199, -0.89475602, -0.010862361, 0.12338739, 0.23432767;
% 0.220571, -0.186432, -1.003, 0, 0, 0, 0.013587612, -0.011484582, -0.061786797;
% 0, 0, 0, 0.220571, -0.186432, -1.003, -0.010372127, 0.008766776, 0.047165059;
% -0.104975, -0.249219, -0.97045898, 0, 0, 0, 0.015128369, 0.035915952, 0.13985674;
% 0, 0, 0, -0.104975, -0.249219, -0.97045898, 0.01287319, 0.030561978, 0.11900837;
% 0.28928, -0.345395, -0.94768101, 0, 0, 0, 0.035249054, -0.042086724, -0.11547588;
% 0, 0, 0, 0.28928, -0.345395, -0.94768101, -0.043492094, 0.051928759, 0.14248006;
% -0.274968, -0.531717, -0.86328602, 0, 0, 0, 0.062453751, 0.1207694, 0.196079;
% 0, 0, 0, -0.274968, -0.531717, -0.86328602, 0.092132702, 0.17816082, 0.28925866;
% -0.018699501, -0.31233001, -0.95028299, 0, 0, 0, 0.0015296566, 0.02554922, 0.077735052;
% 0, 0, 0, -0.018699501, -0.31233001, -0.95028299, 0.0029513419, 0.049295042, 0.14998315;
% -0.20902, -0.49366799, -0.879026, 0, 0, 0, 0.039281759, 0.092776515, 0.165198;
% 0, 0, 0, -0.20902, -0.49366799, -0.879026, 0.063167095, 0.14918941, 0.2656469;
% -0.19432899, -0.43833601, -0.899454, 0, 0, 0, 0.035713781, 0.080557391, 0.16530165;
% 0, 0, 0, -0.19432899, -0.43833601, -0.899454, 0.050998345, 0.11503384, 0.23604643;
% 0.14303701, -0.36325201, -0.93679798, 0, 0, 0, 0.0040659695, -0.0103258, -0.026629414;
% 0, 0, 0, 0.14303701, -0.36325201, -0.93679798, -0.02533786, 0.064347185, 0.16594626;
% 0.085636303, -0.41906899, -0.9149, 0, 0, 0, -0.0002974142, 0.0014554233, 0.0031774405;
% 0, 0, 0, 0.085636303, -0.41906899, -0.9149, -0.018965529, 0.092809536, 0.20261925;
% -0.159904, -0.178302, -0.994403, 0, 0, 0, 0.029868469, 0.033305034, 0.18574454;
% 0, 0, 0, -0.159904, -0.178302, -0.994403, 0.012621544, 0.014073736, 0.078490227;
% -0.142933, -0.49206501, -0.88160902, 0, 0, 0, 0.020737149, 0.071390271, 0.12790649;
% 0, 0, 0, -0.142933, -0.49206501, -0.88160902, 0.042104628, 0.14495054, 0.25970086;
% -0.155847, -0.20867901, -0.98355597, 0, 0, 0, 0.028236672, 0.03780888, 0.17820264;
% 0, 0, 0, -0.155847, -0.20867901, -0.98355597, 0.015517843, 0.02077838, 0.097933665;
% 0.116758, -0.140865, -1.01631, 0, 0, 0, -0.001215216, 0.0014661215, 0.010577744;
% 0, 0, 0, 0.116758, -0.140865, -1.01631, -0.0030013802, 0.0036210746, 0.026125258]
% r = [0.013004784, -0.013004784, 0.91699964, 0.90971547, 0.90301561, -0.90301561, -0.90971547, -0.91699964, 0.011810152, 0.0042730882, -0.0032648849, 0.0032648849, -0.0042730882, -0.011810152, 0.90677714, 0.89949346, 0.89276755, -0.89276755, -0.89949346, -0.90677714, 0.87191159, 0.86462778, 0.85781735, -0.85781735, -0.86462778, -0.87191159, -0.46660486, 0.46660486, 0.98123449, -0.98123449, -0.8833797, 0.8833797, 0.20231977, -0.20231977, 0.93914324, -0.93914324, -0.95379329, 0.95379329, 0.37624162, -0.37624162, 0.92592204, -0.92592204, -0.96510983, 0.96510983, 0.96937585, -0.96937585, -1.0428663, 1.0428663, -0.84868819, 0.84868819, 0.9898954, -0.9898954;
% 0.012494692, -0.012494692, -0.21099815, -0.21799658, -0.22443366, 0.22443366, 0.21799658, 0.21099815, 0.0062189284, -0.0010225052, -0.0082648126, 0.0082648126, 0.0010225052, -0.0062189284, -0.2085411, -0.21553908, -0.22200119, 0.22200119, 0.21553908, 0.2085411, -0.20016126, -0.20715937, -0.21370266, 0.21370266, 0.20715937, 0.20016126, -0.24110807, 0.24110807, -0.17608631, 0.17608631, 0.27217641, -0.27217641, 0.30937949, -0.30937949, -0.23325688, 0.23325688, 0.21861152, -0.21861152, 0.26783553, -0.26783553, -0.24437012, 0.24437012, 0.20466197, -0.20466197, -0.02248399, 0.02248399, 0.14881331, -0.14881331, 0.12067833, -0.12067833, -0.14032826, 0.14032826;
% 0.039508261, -0.039508261, -0.20041643, -0.22254552, -0.24289957, 0.24289957, 0.22254552, 0.20041643, 0.021856103, -0.0010413369, -0.023941539, 0.023941539, 0.0010413369, -0.021856103, -0.19789538, -0.22002305, -0.24045625, 0.24045625, 0.22002305, 0.19789538, -0.18929793, -0.21142597, -0.23211591, 0.23211591, 0.21142597, 0.18929793, -0.85096812, 0.85096812, -0.078564703, 0.078564703, 0.38152361, -0.38152361, 0.92916691, -0.92916691, -0.25219262, 0.25219262, 0.20612454, -0.20612454, 0.88696468, -0.88696468, -0.28801319, 0.28801319, 0.16332978, -0.16332978, 0.33661261, -0.33661261, -0.021327198, 0.021327198, -0.018524086, 0.018524086, 0.022776663, -0.022776663;
% -0.0024697569, 0.0024697569, 0.14062209, 0.14200543, 0.14327781, -0.14327781, -0.14200543, -0.14062209, -0.000764772, 0.00066660228, 0.0020981494, -0.0020981494, -0.00066660228, 0.000764772, 0.13902423, 0.14040749, 0.14168482, -0.14168482, -0.14040749, -0.13902423, 0.13357458, 0.13495785, 0.13625123, -0.13625123, -0.13495785, -0.13357458, -0.07565356, 0.07565356, 0.15354924, -0.15354924, -0.13731393, 0.13731393, 0.19574398, -0.19574398, 0.1425924, -0.1425924, -0.15320681, 0.15320681, 0.13497213, -0.13497213, 0.13958277, -0.13958277, -0.15615851, 0.15615851, 0.13549909, -0.13549909, -0.14750434, 0.14750434, -0.13847645, 0.13847645, 0.13961038, -0.13961038;
% -0.03817264, 0.03817264, 0.99044669, 1.0118276, 1.0314935, -1.0314935, -1.0118276, -0.99044669, -0.01737557, 0.0047477977, 0.026873834, -0.026873834, -0.0047477977, 0.01737557, 0.97905171, 1.0004313, 1.0201738, -1.0201738, -1.0004313, -0.97905171, 0.94018853, 0.96156847, 0.98155898, -0.98155898, -0.96156847, -0.94018853, -0.57424796, 0.57424796, 1.0995308, -1.0995308, -0.97189951, 0.97189951, 2.2024055, -2.2024055, 0.99632943, -0.99632943, -1.1129317, 1.1129317, 1.3486197, -1.3486197, 0.96947986, -0.96947986, -1.1406606, 1.1406606, 0.9026475, -0.9026475, -0.98405647, 0.98405647, -1.0204728, 1.0204728, 0.92934632, -0.92934632;
% -0.14050162, 0.14050162, 0.022142431, 0.10083919, 0.17322345, -0.17322345, -0.10083919, -0.022142431, -0.080968864, 0.00046036832, 0.081899427, -0.081899427, -0.00046036832, 0.080968864, 0.020941759, 0.09963353, 0.17229931, -0.17229931, -0.09963353, -0.020941759, 0.016850226, 0.095543273, 0.16912204, -0.16912204, -0.095543273, -0.016850226, -0.29101819, 0.29101819, 0.14578436, -0.14578436, -0.053683281, 0.053683281, 5.5854692, -5.5854692, -0.031456992, 0.031456992, -0.25236842, 0.25236842, 2.7048802, -2.7048802, -0.070041895, 0.070041895, -0.29962492, 0.29962492, -0.32735676, 0.32735676, 0.34669581, -0.34669581, -0.32618448, 0.32618448, -0.34194738, 0.34194738;
% -0.049182992, 0.049182992, -0.027429845, 0.00011817941, 0.025456499, -0.025456499, -0.00011817941, 0.027429845, -0.028508587, -4.0501695e-06, 0.028503925, -0.028503925, 4.0501695e-06, 0.028508587, -0.027454576, 9.1702103e-05, 0.025528567, -0.025528567, -9.1702103e-05, 0.027454576, -0.02753769, 9.0345548e-06, 0.025765492, -0.025765492, -9.0345548e-06, 0.02753769, 0.1853237, -0.1853237, -0.031701293, 0.031701293, -0.031024078, 0.031024078, 1.2416414, -1.2416414, -0.030495288, 0.030495288, -0.032489471, 0.032489471, 0.46237311, -0.46237311, -0.030367211, 0.030367211, -0.033064228, 0.033064228, 0.00043759402, -0.00043759402, -0.021571396, 0.021571396, -0.00030393124, 0.00030393124, -0.00040125963, 0.00040125963;
% -0.58579981, 0.58579981, -0.32674301, 0.001370983, 0.303166, -0.303166, -0.001370983, 0.32674301, -0.33955503, -4.8411919e-05, 0.33949918, -0.33949918, 4.8411919e-05, 0.33955503, -0.32703716, 0.0010560335, 0.30402479, -0.30402479, -0.0010560335, 0.32703716, -0.3280257, 7.2815812e-05, 0.30684814, -0.30684814, -7.2815812e-05, 0.3280257, 2.2072623, -2.2072623, -0.37760875, 0.37760875, -0.36946723, 0.36946723, 14.788885, -14.788885, -0.3632597, 0.3632597, -0.38693607, 0.38693607, 5.507257, -5.507257, -0.36173728, 0.36173728, -0.39378554, 0.39378554, 0.0050849216, -0.0050849216, -0.2567983, 0.2567983, -0.0036087241, 0.0036087241, -0.0048952708, 0.0048952708;
% -1.6221372, 1.6221372, -0.90476871, 0.0038111056, 0.83951122, -0.83951122, -0.0038111056, 0.90476871, -0.94026119, -0.00013398823, 0.94010663, -0.94010663, 0.00013398823, 0.94026119, -0.90558344, 0.002938814, 0.84188908, -0.84188908, -0.002938814, 0.90558344, -0.90832138, 0.00021562329, 0.84970659, -0.84970659, -0.00021562329, 0.90832138, 6.112052, -6.112052, -1.0456088, 1.0456088, -1.0230939, 1.0230939, 40.952053, -40.952053, -1.0058907, 1.0058907, -1.0714841, 1.0714841, 15.250258, -15.250258, -1.0016786, 1.0016786, -1.0904551, 1.0904551, 0.014116738, -0.014116738, -0.71111876, 0.71111876, -0.010025902, 0.010025902, -0.013537008, 0.013537008]
% 
